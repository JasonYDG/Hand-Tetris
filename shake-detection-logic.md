# 头部晃动检测逻辑说明

## 🎯 检测原理

### 双重条件检测
头部晃动需要同时满足两个条件：
1. **范围条件**：头部左右移动范围 > 5%屏幕宽度
2. **方差条件**：头部位置方差 > 0.0005

### 连续性要求
- **历史帧数**：保存最近15帧的头部位置
- **连续要求**：需要连续8帧都满足双重条件
- **重置机制**：任何一帧不满足条件，连续计数归零

## 🔧 参数设置

```javascript
// 检测参数
headHistorySize = 15;           // 历史帧数
rangeThreshold = 0.05;          // 5%屏幕宽度
varianceThreshold = 0.0005;     // 方差阈值
requiredShakeFrames = 8;        // 需要连续8帧

// 快速下降参数
fastDropTriggerDelay = 100;     // 0.1秒延迟
fastDropInterval = 40;          // 40ms间隔
```

## 📊 检测流程

1. **数据收集**：每帧记录鼻子的x坐标
2. **范围计算**：计算最近15帧中x坐标的最大值和最小值差
3. **方差计算**：计算最近15帧中x坐标的方差
4. **条件判断**：检查是否同时满足范围和方差条件
5. **连续性检查**：
   - 满足条件：连续计数+1
   - 不满足条件：连续计数归零
6. **状态确认**：连续计数≥8帧时确认为晃动状态

## 🎮 游戏触发

1. **检测到晃动**：开始0.1秒倒计时
2. **倒计时结束**：激活快速下降
3. **快速下降**：每40ms下移一格
4. **结束条件**：方块触底或停止晃动

## 🧪 测试建议

### 正常晃动（应该触发）
- 左右晃动头部，幅度约为屏幕宽度的5-10%
- 持续晃动至少0.3秒（约8-10帧）
- 保持相对稳定的晃动频率

### 误触发避免（不应该触发）
- 轻微的头部移动
- 短暂的位置调整
- 单次快速移动
- 上下点头动作

## 🔍 调试信息

控制台会显示：
- 实时的范围百分比和方差值
- 连续帧数计数
- 状态变化提示
- 快速下降触发确认

这样的设计确保只有明确的连续晃动才会触发快速下降，避免误操作。